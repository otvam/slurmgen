#!/bin/bash

####################################### sbatch name

#SBATCH --job-name="test"
#SBATCH --output="slurm_output/test.log"

####################################### sbatch resources

#SBATCH --time="23:00:00"
#SBATCH --nodes="1"
#SBATCH --ntasks-per-node="16"
#SBATCH --mem="64G"

####################################### start

echo "================================= SLURM START"

####################################### summary

echo "==================== PARAM"
echo "TAG          : test"
echo "LOG FILE     : slurm_output/test.log"
echo "SLURM FILE   : slurm_output/test.slm"

echo "==================== SLURM"
echo "JOB ID       : $SLURM_JOB_ID"
echo "JOB NAME     : $SLURM_JOB_NAME"
echo "JOB NODE     : $SLURM_JOB_NODELIST"

####################################### environment

echo "==================== FOLDER CREATE"
mkdir -p "data_input"
mkdir -p "data_output"

echo "==================== ENV VAR"
export PYPEEC="config/config_hpc.yaml"
export PYTHONUNBUFFERED="1"
export CONFIGHPC="1"

echo "==================== CONDA LOAD"
source "/optnfs/common/miniconda3/etc/profile.d/conda.sh"

echo "==================== CONDA ACTIVATE"
conda activate "pypeec"

####################################### run

echo "==================== RUN"
python run_solve.py

####################################### end

echo "======================================== SLURM END"
exit 0
